{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["Negociacao","ListaNegociacoes","Mensagem","NegociacaoService","ConnectionFactory","NegociacaoDao","DateHelper","Bind","NegociacoesView","MensagemView","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","_mensagem","_service","_init","getConnection","then","connection","dao","listarTodos","negociacoes","forEach","adiciona","negociacao","catch","errorMessage","text","setInterval","importarNegociacoes","event","preventDefault","_criarNegociacao","_limparFormulario","_Mensagem","importa","texto","apagar","esvazia","message","mensagem","column","inverterOrdem","ordenar","a","b","data","Date","textToDate","value","parseInt","parseFloat","focus","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {Negociacao} from '../models/Negociacao';\nimport {ListaNegociacoes} from '../models/ListaNegociacoes';\nimport {Mensagem} from '../models/Mensagem';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {ConnectionFactory} from '../services/ConnectionFactory';\nimport {NegociacaoDao} from '../dao/NegociacaoDao';\nimport {DateHelper} from '../helpers/DateHelper';\nimport {Bind} from '../helpers/Bind';\nimport {NegociacoesView} from '../views/NegociacoesView';\nimport {MensagemView} from '../views/MensagemView';\n\nclass NegociacaoController {\n    \n    constructor(){\n        let $ = document.querySelector.bind(document);\n        this._inputData = $(\"#data\");\n        this._inputQuantidade = $(\"#quantidade\");\n        this._inputValor = $(\"#valor\");\n\n        this._ordemAtual = \"\";\n\n        this._listaNegociacoes = new Bind(\n            new ListaNegociacoes(),\n            new NegociacoesView($(\"#negociacoesView\")),\n            \"adiciona\", \"esvazia\", \"ordenar\", \"inverterOrdem\"\n        );\n        \n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView($(\"#mensagemView\")),\n            \"text\"\n        );\n\n        this._service = new NegociacaoService();\n\n        this._init();\n    }\n\n    _init(){\n        ConnectionFactory\n            .getConnection()\n            .then(connection => new NegociacaoDao(connection))\n            .then(dao => dao.listarTodos())\n            .then(negociacoes => \n                negociacoes.forEach(\n                    negociacao => this._listaNegociacoes.adiciona(negociacao)))\n            .catch((errorMessage) => this._mensagem.text = errorMessage);\n\n        setInterval(() => this.importarNegociacoes(), 3000);\n    }\n\n    adiciona (event) {\n        event.preventDefault();\n        let negociacao = this._criarNegociacao();\n\n        this._service\n            .adiciona(negociacao)\n            .then(() => {\n                this._listaNegociacoes.adiciona(negociacao);\n                this._limparFormulario();\n                this._mensagem.text = \"Negociação adiconada com sucesso!\";\n            })\n            .catch((errorMessage) => this._Mensagem.text = errorMessage);\n    }\n\n    importarNegociacoes (){\n        this._service\n            .importa(this._listaNegociacoes.negociacoes)\n            .then(negociacoes => \n                negociacoes.forEach(negociacao => {\n                    this._listaNegociacoes.adiciona(negociacao);\n                    this._mensagem.texto = 'Negociações do período importadas'}))\n            .catch(errorMessage => this._mensagem.texto = errorMessage);\n    }\n\n    apagar(event) {\n        event.preventDefault();\n        this._service\n            .apagar()\n            .then(message => {\n                this._listaNegociacoes.esvazia();\n                this._mensagem.text = message;\n            })\n            .catch(message => this._mensagem = mensagem);\n    }\n\n    ordena(column){\n        \n        if(this._ordemAtual == column){\n            this._listaNegociacoes.inverterOrdem();\n        } else {\n            this._listaNegociacoes.ordenar( (a,b) => a[column] - b[column]);\n        }\n        this._ordemAtual = column;\n    }\n\n    _criarNegociacao(){\n        //Date recebe ANO / MES / DIA\n        let data = new Date(DateHelper.textToDate(this._inputData.value));       \n        return new Negociacao(data, parseInt(this._inputQuantidade.value), parseFloat(this._inputValor.value));\n    }\n\n    _limparFormulario(){\n        this._inputData.value = \"\";\n        this._inputQuantidade.value = \"\";\n        this._inputValor.value = \"\";\n\n        focus(this._inputData);\n    }\n\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance(){\n    return negociacaoController;\n}"]}