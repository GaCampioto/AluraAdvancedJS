{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_ordemAtual","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_service","NegociacaoService","_init","ConnectionFactory","getConnection","then","NegociacaoDao","connection","dao","listarTodos","negociacoes","forEach","adiciona","negociacao","catch","errorMessage","text","setInterval","importarNegociacoes","event","preventDefault","_criarNegociacao","_limparFormulario","_Mensagem","importa","texto","apagar","esvazia","message","mensagem","column","inverterOrdem","ordenar","a","b","data","Date","DateHelper","textToDate","value","Negociacao","parseInt","parseFloat","focus"],"mappings":";;;;;;IAAMA,oB;AAEF,oCAAa;AAAA;;AACT,YAAIC,IAAIC,SAASC,aAAT,CAAuBC,IAAvB,CAA4BF,QAA5B,CAAR;AACA,aAAKG,UAAL,GAAkBJ,EAAE,OAAF,CAAlB;AACA,aAAKK,gBAAL,GAAwBL,EAAE,aAAF,CAAxB;AACA,aAAKM,WAAL,GAAmBN,EAAE,QAAF,CAAnB;;AAEA,aAAKO,WAAL,GAAmB,EAAnB;;AAEA,aAAKC,iBAAL,GAAyB,IAAIC,IAAJ,CACrB,IAAIC,gBAAJ,EADqB,EAErB,IAAIC,eAAJ,CAAoBX,EAAE,kBAAF,CAApB,CAFqB,EAGrB,UAHqB,EAGT,SAHS,EAGE,SAHF,EAGa,eAHb,CAAzB;;AAMA,aAAKY,SAAL,GAAiB,IAAIH,IAAJ,CACb,IAAII,QAAJ,EADa,EAEb,IAAIC,YAAJ,CAAiBd,EAAE,eAAF,CAAjB,CAFa,EAGb,MAHa,CAAjB;;AAMA,aAAKe,QAAL,GAAgB,IAAIC,iBAAJ,EAAhB;;AAEA,aAAKC,KAAL;AACH;;;;gCAEM;AAAA;;AACHC,8BACKC,aADL,GAEKC,IAFL,CAEU;AAAA,uBAAc,IAAIC,aAAJ,CAAkBC,UAAlB,CAAd;AAAA,aAFV,EAGKF,IAHL,CAGU;AAAA,uBAAOG,IAAIC,WAAJ,EAAP;AAAA,aAHV,EAIKJ,IAJL,CAIU;AAAA,uBACFK,YAAYC,OAAZ,CACI;AAAA,2BAAc,MAAKlB,iBAAL,CAAuBmB,QAAvB,CAAgCC,UAAhC,CAAd;AAAA,iBADJ,CADE;AAAA,aAJV,EAOKC,KAPL,CAOW,UAACC,YAAD;AAAA,uBAAkB,MAAKlB,SAAL,CAAemB,IAAf,GAAsBD,YAAxC;AAAA,aAPX;;AASAE,wBAAY;AAAA,uBAAM,MAAKC,mBAAL,EAAN;AAAA,aAAZ,EAA8C,IAA9C;AACH;;;iCAESC,K,EAAO;AAAA;;AACbA,kBAAMC,cAAN;AACA,gBAAIP,aAAa,KAAKQ,gBAAL,EAAjB;;AAEA,iBAAKrB,QAAL,CACKY,QADL,CACcC,UADd,EAEKR,IAFL,CAEU,YAAM;AACR,uBAAKZ,iBAAL,CAAuBmB,QAAvB,CAAgCC,UAAhC;AACA,uBAAKS,iBAAL;AACA,uBAAKzB,SAAL,CAAemB,IAAf,GAAsB,mCAAtB;AACH,aANL,EAOKF,KAPL,CAOW,UAACC,YAAD;AAAA,uBAAkB,OAAKQ,SAAL,CAAeP,IAAf,GAAsBD,YAAxC;AAAA,aAPX;AAQH;;;8CAEqB;AAAA;;AAClB,iBAAKf,QAAL,CACKwB,OADL,CACa,KAAK/B,iBAAL,CAAuBiB,WADpC,EAEKL,IAFL,CAEU;AAAA,uBACFK,YAAYC,OAAZ,CAAoB,sBAAc;AAC9B,2BAAKlB,iBAAL,CAAuBmB,QAAvB,CAAgCC,UAAhC;AACA,2BAAKhB,SAAL,CAAe4B,KAAf,GAAuB,mCAAvB;AAA2D,iBAF/D,CADE;AAAA,aAFV,EAMKX,KANL,CAMW;AAAA,uBAAgB,OAAKjB,SAAL,CAAe4B,KAAf,GAAuBV,YAAvC;AAAA,aANX;AAOH;;;+BAEMI,K,EAAO;AAAA;;AACVA,kBAAMC,cAAN;AACA,iBAAKpB,QAAL,CACK0B,MADL,GAEKrB,IAFL,CAEU,mBAAW;AACb,uBAAKZ,iBAAL,CAAuBkC,OAAvB;AACA,uBAAK9B,SAAL,CAAemB,IAAf,GAAsBY,OAAtB;AACH,aALL,EAMKd,KANL,CAMW;AAAA,uBAAW,OAAKjB,SAAL,GAAiBgC,QAA5B;AAAA,aANX;AAOH;;;+BAEOV,K,EAAOW,M,EAAO;AAClBX,kBAAMC,cAAN;;AAEA,gBAAG,KAAK5B,WAAL,IAAoBsC,MAAvB,EAA8B;AAC1B,qBAAKrC,iBAAL,CAAuBsC,aAAvB;AACH,aAFD,MAEO;AACH,qBAAKtC,iBAAL,CAAuBuC,OAAvB,CAAgC,UAACC,CAAD,EAAGC,CAAH;AAAA,2BAASD,EAAEH,MAAF,IAAYI,EAAEJ,MAAF,CAArB;AAAA,iBAAhC;AACH;AACD,iBAAKtC,WAAL,GAAmBsC,MAAnB;AACH;;;2CAEiB;AACd;AACA,gBAAIK,OAAO,IAAIC,IAAJ,CAASC,WAAWC,UAAX,CAAsB,KAAKjD,UAAL,CAAgBkD,KAAtC,CAAT,CAAX;AACA,mBAAO,IAAIC,UAAJ,CAAeL,IAAf,EAAqBM,SAAS,KAAKnD,gBAAL,CAAsBiD,KAA/B,CAArB,EAA4DG,WAAW,KAAKnD,WAAL,CAAiBgD,KAA5B,CAA5D,CAAP;AACH;;;4CAEkB;AACf,iBAAKlD,UAAL,CAAgBkD,KAAhB,GAAwB,EAAxB;AACA,iBAAKjD,gBAAL,CAAsBiD,KAAtB,GAA8B,EAA9B;AACA,iBAAKhD,WAAL,CAAiBgD,KAAjB,GAAyB,EAAzB;;AAEAI,kBAAM,KAAKtD,UAAX;AACH","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\n    \n    constructor(){\n        let $ = document.querySelector.bind(document);\n        this._inputData = $(\"#data\");\n        this._inputQuantidade = $(\"#quantidade\");\n        this._inputValor = $(\"#valor\");\n\n        this._ordemAtual = \"\";\n\n        this._listaNegociacoes = new Bind(\n            new ListaNegociacoes(),\n            new NegociacoesView($(\"#negociacoesView\")),\n            \"adiciona\", \"esvazia\", \"ordenar\", \"inverterOrdem\"\n        );\n        \n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView($(\"#mensagemView\")),\n            \"text\"\n        );\n\n        this._service = new NegociacaoService();\n\n        this._init();\n    }\n\n    _init(){\n        ConnectionFactory\n            .getConnection()\n            .then(connection => new NegociacaoDao(connection))\n            .then(dao => dao.listarTodos())\n            .then(negociacoes => \n                negociacoes.forEach(\n                    negociacao => this._listaNegociacoes.adiciona(negociacao)))\n            .catch((errorMessage) => this._mensagem.text = errorMessage);\n\n        setInterval(() => this.importarNegociacoes(), 3000);\n    }\n\n    adiciona (event) {\n        event.preventDefault();\n        let negociacao = this._criarNegociacao();\n\n        this._service\n            .adiciona(negociacao)\n            .then(() => {\n                this._listaNegociacoes.adiciona(negociacao);\n                this._limparFormulario();\n                this._mensagem.text = \"Negociação adiconada com sucesso!\";\n            })\n            .catch((errorMessage) => this._Mensagem.text = errorMessage);\n    }\n\n    importarNegociacoes (){\n        this._service\n            .importa(this._listaNegociacoes.negociacoes)\n            .then(negociacoes => \n                negociacoes.forEach(negociacao => {\n                    this._listaNegociacoes.adiciona(negociacao);\n                    this._mensagem.texto = 'Negociações do período importadas'}))\n            .catch(errorMessage => this._mensagem.texto = errorMessage);\n    }\n\n    apagar(event) {\n        event.preventDefault();\n        this._service\n            .apagar()\n            .then(message => {\n                this._listaNegociacoes.esvazia();\n                this._mensagem.text = message;\n            })\n            .catch(message => this._mensagem = mensagem);\n    }\n\n    ordena (event, column){\n        event.preventDefault();\n        \n        if(this._ordemAtual == column){\n            this._listaNegociacoes.inverterOrdem();\n        } else {\n            this._listaNegociacoes.ordenar( (a,b) => a[column] - b[column]);\n        }\n        this._ordemAtual = column;\n    }\n\n    _criarNegociacao(){\n        //Date recebe ANO / MES / DIA\n        let data = new Date(DateHelper.textToDate(this._inputData.value));       \n        return new Negociacao(data, parseInt(this._inputQuantidade.value), parseFloat(this._inputValor.value));\n    }\n\n    _limparFormulario(){\n        this._inputData.value = \"\";\n        this._inputQuantidade.value = \"\";\n        this._inputValor.value = \"\";\n\n        focus(this._inputData);\n    }\n\n}"]}